%META:TOPICINFO{author="ProjectContributor" comment="" date="1418752972" format="1.1"  version="1"}%
%META:TOPICPARENT{name="TopicFunction"}%
%TOC{depth="2"}%

---++ Documentation
%STARTSECTION{"documentation"}%
This uses solr and infintescroll to create a frontpage widget.

---+++++ Parameters
   * HEIGHT: height of scroll container, defaults to 40em
   * LIMIT: number of rows to render, defaults to 20
   * PAGE: from which page to start rendering
   * THEWEB: the web to render recent changes for
   * FILTER: lucene filter to be added to the search query

%ENDSECTION{"documentation"}%

---++ Implementation
<verbatim class="tml">
%STARTINCLUDE%<!-- -->
<div class="jqInfiniteScroll recentChanges {itemSelector:'.clsIndexItem', localMode:true, bufferPx:200}">
%DBCALL{"%WEB%.%TOPIC%" 
  section="backend" 
  LIMIT="%LIMIT{default="20"}%"
  PAGE="%PAGE{default="0"}%"
  THEWEB="%THEWEB{default="%BASEWEB%"}%"
  FILTER="%FILTER{default=""}%"
}%
</div>
<div class="jqInfiniteScrollNavi foswikiHidden">
  <a href="%SCRIPTURLPATH{"view"}%/%WEB%/%TOPIC%?page=1&section=backend&skin=text&web=%THEWEB{default="%BASEWEB%"}%&filter=%FULTER{default=""}%&limit=%LIMIT{default="20"}%" class='jqInfiniteScrollNext'>More</a>
</div>
<literal><style>
.recentChanges {
  overflow-y:auto;
  padding-right:1em;
  height:%HEIGHT{default="40em"}%;
}
</style></literal>
<!-- %JQREQUIRE{"infinitescroll"}% -->%STOPINCLUDE%
</verbatim>

---++ Backend
<verbatim class="tml">
%STARTSECTION{"backend"}%<noautolink>
%DBQUERY{
  "%URLPARAM{"filter" default="%FILTER{default=""}%"}%"
  exclude="^(WebChanges|WebPreferences|WebStatistics|WebTopicList|WebIndex|WebNotify|WebHome|WebLinks|TopCategory|Category|ClassifiedTopic|TopicType|UncategorizedTopics|WebTopicEditTemplate|WebAtom|WebRss|WebLeftBar|WebSearch.*|WebTagList)$"
  web="%URLPARAM{"web" default="%THEWEB{default="%BASEWEB%"}%"}%"
  skip="%CALC{"$EVAL(%URLPARAM{"page" default="%PAGE{default="0"}%"}%*%URLPARAM{"limit" default="%LIMIT{default="20"}%"}%)"}%"
  limit="%URLPARAM{"limit" default="%LIMIT{default="20"}%"}%" 
  sort="modified"
  reverse="on"
  format="$percntDBCALL{\"$web.$topic->RenderIndexItem\"}$percnt"
  separator="$n"
}%
</noautolink>%ENDSECTION{"backend"}%
</verbatim>

---++ Test
%DBCALL{"%TOPIC%" HEIGHT="20em"}%

%DBCALL{"Applications.RenderFunctionCallers"}%

---++ Copyright
&copy; 2006-2014 Michael Daum http://michaeldaumconsulting.com

%DBCALL{"Applications.GnuGeneralPublicLicense" section="notice"}%

</verbatim>

%META:FORM{name="Applications.ApplicationTopic"}%
%META:FIELD{name="TopicType" title="TopicType" value="DocuTopic, TopicFunction, WikiTopic"}%
%META:FIELD{name="TopicTitle" attributes="" title="<nop>TopicTitle" value=""}%
%META:FIELD{name="Summary" attributes="c" title="Summary" value="renders a list of recent changes in a web"}%
%META:FIELD{name="WikiApplication" attributes="" title="WikiApplication" value="none"}%
%META:PREFERENCE{name="EDIT_TEMPLATE" title="EDIT_TEMPLATE" type="Set" value="Applications.WikiTopicEdit"}%
